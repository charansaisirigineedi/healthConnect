<!DOCTYPE html>
<html lang="en">
    {% include 'doctor/header.html' %}
  <body>
    <!-- Preloader -->
    <!-- --------------------------------------------------- -->
    <!-- Body Wrapper -->
    <!-- --------------------------------------------------- -->
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-sidebartype="full" data-sidebar-position="fixed" data-header-position="fixed">
      <!-- --------------------------------------------------- -->
      <!-- Sidebar -->
      <!-- --------------------------------------------------- -->
      {% include 'doctor/sidebar-doctor.html' %}
      <!-- --------------------------------------------------- -->
      <!-- Main Wrapper -->
      <!-- --------------------------------------------------- -->
      <div class="body-wrapper">
        <!-- --------------------------------------------------- -->
        <!-- Header Start -->
        <!-- --------------------------------------------------- -->
        {% include 'doctor/header-doctor.html' %}
        <!-- --------------------------------------------------- -->
        <!-- Header End -->
        <!-- --------------------------------------------------- -->
      
        <div class="container-fluid">
          <div class="card bg-light-info shadow-none position-relative overflow-hidden">
            <div class="card-body px-4 py-3">
                <div class="row align-items-center">
                    <div class="col-9">
                        <h4 class="fw-semibold mb-8">Prescriptions List</h4>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a class="text-muted " href="javascript:void(0)">Current</a>
                                </li>
                                <li class="breadcrumb-item" aria-current="page">
                                    Prescription
                                </li>
                            </ol>
                        </nav>
                    </div>
                    <div class="col-3">
                        <div class="text-center mb-n5">
                            <img src="../../dist/images/breadcrumb/ChatBc.png" alt="" class="img-fluid mb-n4">
                        </div>
                    </div>
                </div>
            </div>
          </div>
          <div class="card">
            <div class="border-bottom title-part-padding">
              <h4 class="card-title mb-0">Prescriptions List</h4>
              <div class="row">
                <div class="col-md-12">
                    <div class="card invoices-add-card">
                        <div class="card-body">
                            <form class="invoices-form"  id="submit" action="javascript:addMedication();">
                                <div class="invoice-add-table">
                                    <div class="table-responsive">
                                        <table class="table table-center add-table-items">
                                            <thead>
                                                <tr>
                                                    <th>Medicine Name</th>
                                                    <th>Course Days</th>
                                                    <th>Morning</th>
                                                    <th>Afternoon</th>
                                                    <th>Evening</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="add-row">
                                                    <td>
                                                    <!-- <label for="browser">Choose your browser from the list:</label> -->
                                                    <input list="charges" name="charge" id="charge" class="form-control">

                                                        <datalist id="charges">
                                                            {% for medicine in medicines %}
                                                            <option id="{{medicine['_id']}}" value="{{medicine['name']+', '+medicine['manufacturer_name']}}">
                                                            {% endfor %}
                                                        </datalist>
                                                    </td>
                                                    <td>
                                                        <input type="number"  min="1" name="days" id="days"  class="form-control">
                                                    </td>
                                                    <td>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" name="mor" id="mor">
                                                          </div>
                                                    </td>
                                                    <td>
                                                        <input class="form-check-input" type="checkbox"  name="aft" id="aft">
                                                    </td>
                                                    <td>
                                                        <input class="form-check-input" type="checkbox" name="evn" id="evn">
                                                    </td>
                                                    <td>
                                                    <button type="submit"  class="btn btn-primary">Add</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-end">
                    <button type="submit" onclick="sendDataToServer()" class="btn btn-primary">Finish</button>										
            </div>
            </div>
            <script>
                // Function to send data to the server
                function sendDataToServer() {
                    // Retrieve the medication array from local storage
                    var medicationArray = JSON.parse(localStorage.getItem('medicationArray')) || [];
                    console.log(medicationArray)
                    // Send the medicationArray to the server via an HTTP POST request
                    fetch('/prescriptions_pdf', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ data: medicationArray })
                    })
                    .then(response => {
                        if (response.ok) {
                            // Clear local storage if the data was successfully sent                     
                        } else {
                            console.log('Error sending data to the server.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                }
            </script>
        
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
          <script src="/static/assets/extra-libs/jsgrid/db.js"></script>
          <script src="/static/assets/extra-libs/jsgrid/render.js"></script>
         
          <div class="selected-medicines">
            <div class="border-bottom title-part-padding">
            <h4>Selected Medicines</h4>
            <div class="card">
            <div class="invoice-add-table">
                <div class="table-responsive">
                    <table class="table table-center add-table-items" id="medicationTable">
                        <thead>
                            <tr>
                                <th>Medicine Name</th>
                                <th>Course Days</th>
                                <th>Morning</th>
                                <th>Afternoon</th>
                                <th>Evening</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div></div>
          </div>
        </div>
        </div>
      </div>
    </div>

    <!--  Shopping Cart -->
    <!--  Mobilenavbar -->
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="mobilenavbar" aria-labelledby="offcanvasWithBothOptionsLabel">
      <nav class="sidebar-nav scroll-sidebar">
        <div class="offcanvas-header justify-content-between">
          <img src="../../dist/images/logos/favicon.ico" alt="" class="img-fluid">
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body profile-dropdown mobile-navbar" data-simplebar="" data-simplebar="">
          <ul id="sidebarnav">
            <li class="sidebar-item">
              <a class="sidebar-link has-arrow" href="javascript:void(0)" aria-expanded="false">
                <span>
                  <i class="ti ti-apps"></i>
                </span>
                <span class="hide-menu">Apps</span>
              </a>
              <ul aria-expanded="false" class="collapse first-level my-3">
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-chat.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Chat Application</h6>
                      <span class="fs-2 d-block fw-normal text-muted">New messages arrived</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-invoice.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Invoice App</h6>
                      <span class="fs-2 d-block fw-normal text-muted">Get latest invoice</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-mobile.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Contact Application</h6>
                      <span class="fs-2 d-block fw-normal text-muted">2 Unsaved Contacts</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-message-box.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Email App</h6>
                      <span class="fs-2 d-block fw-normal text-muted">Get new emails</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-cart.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">User Profile</h6>
                      <span class="fs-2 d-block fw-normal text-muted">learn more information</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-date.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Calendar App</h6>
                      <span class="fs-2 d-block fw-normal text-muted">Get dates</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-lifebuoy.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Contact List Table</h6>
                      <span class="fs-2 d-block fw-normal text-muted">Add new contact</span>
                    </div>
                  </a>
                </li>
                <li class="sidebar-item py-2">
                  <a href="#" class="d-flex align-items-center">
                    <div class="bg-light rounded-1 me-3 p-6 d-flex align-items-center justify-content-center">
                      <img src="../../dist/images/svgs/icon-dd-application.svg" alt="" class="img-fluid" width="24" height="24">
                    </div>
                    <div class="d-inline-block">
                      <h6 class="mb-1 bg-hover-primary">Notes Application</h6>
                      <span class="fs-2 d-block fw-normal text-muted">To-do and Daily tasks</span>
                    </div>
                  </a>
                </li>
                <ul class="px-8 mt-7 mb-4">
                  <li class="sidebar-item mb-3">
                    <h5 class="fs-5 fw-semibold">Quick Links</h5>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">Pricing Page</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">Authentication Design</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">Register Now</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">404 Error Page</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">Notes App</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">User Application</a>
                  </li>
                  <li class="sidebar-item py-2">
                    <a class="fw-semibold text-dark" href="#">Account Settings</a>
                  </li>
                </ul>
              </ul>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="app-chat.html" aria-expanded="false">
                <span>
                  <i class="ti ti-message-dots"></i>
                </span>
                <span class="hide-menu">Chat</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="app-calendar.html" aria-expanded="false">
                <span>
                  <i class="ti ti-calendar"></i>
                </span>
                <span class="hide-menu">Calendar</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="app-email.html" aria-expanded="false">
                <span>
                  <i class="ti ti-mail"></i>
                </span>
                <span class="hide-menu">Email</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <!--  Search Bar -->
    <script>
        function addMedication() {
            // Get the values from the input fields
            var medicine_name = document.getElementById('charge').value;
            var quantity = document.getElementById('days').value;
    
            // Get the state of the checkboxes (1 for checked, 0 for unchecked)
            var morning = document.getElementById('mor');
            var mor = morning.checked ? 1 : '-';
            var afternoon = document.getElementById('aft');
            var aft = afternoon.checked ? 1 : '-';
            var evening = document.getElementById('evn');
            var evn = evening.checked ? 1 : '-';
    
            // Create a medication object with key-value pairs
            var medicineDetails = {
                medicine_name: medicine_name,
                quantity: quantity,
                morning: mor,
                afternoon: aft,
                evening: evn,
            };
    
            // Get the existing medication array from local storage (or initialize it if it doesn't exist)
            var medicationArray = JSON.parse(localStorage.getItem('medicationArray')) || [];
    
            // Add the new medication object to the array
            medicationArray.push(medicineDetails);
    
            // Store the updated medication array back in local storage
            localStorage.setItem('medicationArray', JSON.stringify(medicationArray));
    
    
            // window.location.reload();
        }
    </script>

    <script>
        // Function to retrieve and display medication data
        function displayMedicationData() {
            // Retrieve the medication array from local storage
            var medicationArray = JSON.parse(localStorage.getItem('medicationArray')) || [];

            // Get the table element
            var table = document.getElementById('medicationTable');

            // Loop through the medication array and create rows for each medication
            for (var i = 0; i < medicationArray.length; i++) {
                var medication = medicationArray[i];

                // Create a new row
                var row = table.insertRow(-1);

                // Create cells for each key-value pair in the medication object
                for (var key in medication) {
                    if (medication.hasOwnProperty(key)) {
                        var cell = row.insertCell();
                        cell.innerHTML = medication[key];
                    }
                }
                var deleteCell = row.insertCell();
                var deleteButton = document.createElement("button");

                deleteButton.innerHTML = "Delete";
                deleteButton.className = "btn btn-primary"; 
                deleteButton.onclick = function() {
                    // Find the index of the clicked row
                    var rowIndex = this.parentNode.parentNode.rowIndex;

                    // Remove the corresponding medication object from the array
                    medicationArray.splice(rowIndex - 1, 1);

                    // Update local storage with the modified array
                    localStorage.setItem('medicationArray', JSON.stringify(medicationArray));

                    // Remove the clicked row from the table
                    table.deleteRow(rowIndex);
                    window.location.reload();
                };
                deleteCell.appendChild(deleteButton);

            }
            
        }

        // Call the function to display medication data when the page loads
        displayMedicationData();
    </script>

    <!-- --------------------------------------------------- -->
    <!-- Customizer -->
    <!-- --------------------------------------------------- -->
    {% include 'doctor/footer.html' %}
  </body>
</html>